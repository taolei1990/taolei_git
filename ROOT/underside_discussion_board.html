<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>讨论区详情</title>
    <link href="css/animate.min.css" rel="stylesheet" type="text/css">
    <link href="css/swiper-4.2.0.min.css" rel="stylesheet" type="text/css">
    <link href="css/mui.min.css" rel="stylesheet" type="text/css">
    <link href="css/h-studio.css" rel="stylesheet" type="text/css">

</head>
<body >
<!--<header class="mui-bar mui-bar-nav ">-->
    <!--<a class="mui-action-back mui-icon mui-icon-arrowleft mui-pull-left"></a>-->
    <!--<a href="#y-popover" class="mui-icon mui-icon-gear  mui-pull-right"></a>-->
    <!--<h1 class="mui-title">讨论区详情</h1>-->
<!--</header>-->
    <div class="mui-content">
        <div class="y-ktyjnr">
            <div class="y-hdhj-xqy">
                <div class="y-hdhj-tx">
                    <img src="img/Qzone1.png">
                </div>
                <div class="y-hdhj-cs">
                        <span class="y-ktyjmz">陶老师</span>
                        <p>发表于<span class="y-ktyjtim"></span>
                            <span class="y-ktyjliul"><i class="iconfont">&#xe606;</i>150</span>
                            <span class="y-ktyjhuif"><i class="iconfont">&#xe609;</i>160</span></p>
                </div>
            </div>
            <div class="y-hdhj-xqjs">
                <h1 class="titleFont">《麻省理工科技评论》：2018年全球18大关键科技趋势，2017年7大失败技术</h1>
            </div>
            <div class="h-msfxb">
                <h5><span><i class="iconfont">&#xe64b;</i>所有回复(2)</span></h5>
                <div class="y-ktyjsyhf">
                    <div class="y-ktyjsyhf-list">
                    <div class="mui-card">
                        <!--页眉，放置标题-->
                        <div class="mui-card-header mui-card-media">
                            <img src="img/500373494_wx.jpg" />
                            <div class="mui-media-body">
                                陶老师
                                <p>发表于<span class="y-ktyj-plsj"> 2018-06-30 15:30</span>
                                    <span class="y-ktyj-hfs">2回复</span>
                                    <span class="y-ktyj-dzs active"><i class="iconfont ">&#xe696;</i><em>566</em></span>
                                </p>
                            </div>
                        </div>
                        <!--内容区-->
                        <div class="mui-card-content">评论评论评论</div>
                        <!--页脚，放置补充信息或支持的操作-->
                        <div class="y-ktyjhf-hf">
                            <p ><a>张老师</a>回复<a>陶老师</a> 回复回复</p>
                            <p ><a>李老师</a>回复<a>张老师</a> 回复回复阿斯顿</p>
                        </div>
                    </div>
                    </div>
                    <div class="y-ktyjsyhf-list">
                        <div class="mui-card">
                            <!--页眉，放置标题-->
                            <div class="mui-card-header mui-card-media">
                                <img src="img/500373494_wx.jpg" />
                                <div class="mui-media-body">
                                    陶老师
                                    <p> <span class="y-ktyj-plsj">评论于 2018-06-30 15:30</span>
                                        <!--<span class="y-ktyj-hfs">2回复</span>-->
                                        <span class="y-ktyj-dzs"><i class="iconfont">&#xe627;</i><em>566</em></span>
                                    </p>
                                </div>
                            </div>
                            <!--评论的内容区-->
                            <div class="mui-card-content">评论评论评论评论评论评论评论评论评论评论评论评论评论评论评论</div>
                            <!--页脚，放置回复信息或支持的操作
                            <div class="y-ktyjhf-hf">
                                <p ><a>张老师</a>回复<a>陶老师</a> 回复回复</p>
                                <p ><a>李老师</a>回复<a>张老师</a> 回复回复阿斯顿</p>
                            </div>-->
                        </div>
                    </div>
                </div>
            </div>
            <div class="y-jiewei">闻道有先后，术业有专攻</div>
        </div>
    </div>
<div class="y-ktyjcz">
    <div class="y-ktyjbmes" style="width: 100%">
       <a><i class="iconfont">&#xe673;</i>写评论...</a>
    </div>

</div>
<div class="y-plunsck">
    <div class="y-textdiv">
        <div class="y-textdivspan">
            <span class="y-quexiao">取消</span>

            <span class="y-fabiao">发表</span>
        </div>
        <div class="y-inputframe">
            <div class="cgzs-tjfj"></div>
            <textarea rows="5" id="username" class="inputframe" autofocus onKeyUp='keypress()' onblur='keypress()' placeholder="我来说两句"></textarea></div>
    </div>
</div>
<div id="y-popover" class="mui-popover y-popover">
    <ul class="mui-table-view">
        <li class="mui-table-view-cell"><a href="#"><i class="iconfont">&#xe6b9;</i>编辑</a></li>
        <li class="mui-table-view-cell"><a href="#"><i class="iconfont">&#xe65a;</i>置顶</a></li>
        <li class="mui-table-view-cell"><a href="#"><i class="iconfont">&#xe656;</i>加精</a></li>
        <li class="mui-table-view-cell"><a href="#"><i class="iconfont">&#xe674;</i>删除</a></li>
    </ul>
</div>
<script src="js/jquery-3.1.0.min.js"></script>
<script src="js/swiper-4.2.0.min.js"></script>
<script src="js/mui.min.js"></script>
<script src="js/common.js"></script>

<script>
    //讨论区
    $(function(){
        get("/activity/activityList/discuss", function (res){
            if(res.code == 200){
                var data = res.data.discussList;
                if(Object_filter(data)) {
                    $.each(data,function(i,v){
                       // discussionBoard(data[i]);
                        $('.y-ktyjmz').html(data[0].name);
                        $('.y-ktyjtim').html(data[0].datetime);
                        $('.y-ktyjliul').html('<i class="iconfont">&#xe606;</i>'+ data[0].browseQuantity +' ');
                        $('.y-ktyjhuif').html('<i class="iconfont">&#xe609;</i>'+ data[0].commentNum+' ')
                    });
                }
            }
        });
    });

    function discussionBoard(rowData){
        var noteState='';
        if(rowData.noteState==1){
            noteState='<span class="ico-hot">热</span>'
        }else if(rowData.noteState==2){
            noteState='<span class="ico-essence">精</span>'
        }

        var table = document.body.querySelector('.y-discussionBoard');
        var li = document.createElement('li');
        li.className = 'mui-table-view-cell';
        li.innerHTML =' <div class="ys-part-box">' +
            '<div class="ys-forum">' +
            '<b>'+rowData.noteTitle+'</b>' +
            ' '+noteState+' '+
            '</div>' +
            '<div class="ys-forum-portrait">' +
            '<img src='+rowData.headImg+'>' +
            '<a>'+rowData.name+'</a>' +
            '<span><i class="iconfont">&#xe86f;</i>'+rowData.browseQuantity+'</span>' +
            '<span><i class="iconfont">&#xe67d;</i>'+rowData.commentNum+'</span>' +
            '</div>' +
            '</div>';
        table.appendChild(li);
    }
</script>

<script>
//点赞
    mui(".y-ktyjsyhf-list").on('tap', '.y-ktyj-dzs', function () {
        if($(this).hasClass('active'))
        { var z=$(this).find('em').text();
            $(this).removeClass('active').find('em').text(parseInt(z)-1);
            $(this).find('i').remove();
            $(this).prepend("<i class='iconfont'>&#xe627;</i>");
        }
        else {
            var z=$(this).find('em').text();
            $(this).addClass('active').find('em').text(parseInt(z)+1);
            $(this).find('i').remove();
            $(this).prepend("<i class='iconfont'>&#xe696;</i>");
        }
    });


//打开回复框
mui(".y-ktyjsyhf-list").on('tap', '.mui-card-content', function () {
    $('.y-plunsck').show();
    $('.y-ktyjcz').hide();
    $('.inputframe').trigger("click").focus().attr('placeholder',"回复陶老师");
   });
//再次回复框
mui(".y-ktyjhf-hf").on('tap', 'p', function () {
    $('.y-plunsck').show();
    $('.y-ktyjcz').hide();
    $('.inputframe').trigger("click").focus().attr('placeholder',"回复陶老师");
});
    //打开评论框
mui(".y-ktyjbmes").on('tap', 'a', function () {
     $('.y-plunsck').show();
     $('.y-ktyjcz').hide();
     $('.inputframe').trigger("click").focus().attr('placeholder',"我来说两句");
});
//
mui(".y-textdivspan").on('tap', '.y-quexiao', function () {
    $('.y-plunsck').hide();
    $('.y-ktyjcz').show();
});
//打开软键盘
var nativeWebview, imm, InputMethodManager;
var initNativeObjects = function() {
    if (mui.os.android) {
        var main = plus.android.runtimeMainActivity();
        var Context = plus.android.importClass("android.content.Context");
        InputMethodManager = plus.android.importClass("android.view.inputmethod.InputMethodManager");
        imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);
    } else {
        nativeWebview = plus.webview.currentWebview().nativeInstanceObject();
    }
};
var showSoftInput = function() {
    var nativeWebview = plus.webview.currentWebview().nativeInstanceObject();
    if (mui.os.android) {
        //强制当前webview获得焦点
        plus.android.importClass(nativeWebview);
        nativeWebview.requestFocus();
        imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);
    } else {
        nativeWebview.plusCallMethod({
            "setKeyboardDisplayRequiresUserAction": false
        });
    }
    setTimeout(function() {
        //此处可写具体逻辑设置获取焦点的input
        var inputElem = document.querySelector('input.inputframe');
        inputElem.focus();
    }, 200);
};
mui.plusReady(function() {
    initNativeObjects();
    showSoftInput();
});

function keypress() //textarea输入长度处理
{
    var text1=document.getElementById("username").value;

    if(text1.length>0)//textarea控件不能用maxlength属性，就通过这样显示输入字符数了
    {
   $('.y-fabiao').addClass('active');
    }
    else
    {
        $('.y-fabiao').removeClass('active');
    }
}
</script>
<script>
    mui.init({
        gestureConfig:{
            tap: true, //默认为true
            doubletap: true, //默认为false
        }
    });
    mui(".mui-bar-nav").on('doubletap','.mui-title',function(){
        mui.scrollTo(0,100);//回到屏幕顶部
    })
</script>
</body>
</html>