<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--<meta itemprop="name" content="这是一个自定义的标题！">-->
    <!--<meta itemprop="description" content="这是一个自定义的描述！">-->
    <!--<meta itemprop="image" content="http://html.yunjy.com.cn/img/500452692_wx.jpg">-->
    <title>活动</title>
    <link href="css/animate.min.css" rel="stylesheet" type="text/css">
    <link href="css/swiper-4.2.0.min.css" rel="stylesheet" type="text/css"><!--新增2018/7/5-->
    <link href="css/mui.min.css" rel="stylesheet" type="text/css">
    <link href="css/h-studio.css" rel="stylesheet" type="text/css">
    <script src="js/jquery-3.1.0.min.js"></script>
    <script src="js/mui.min.js"></script>
    <script src="js/mui.zoom.js"></script>
    <script src="js/mui.previewimage.js"></script>
    <script src="js/swiper-4.2.0.min.js"></script>
    <script src="js/stickUp.min.js"></script>
    <script src="js/draggabilly.pkgd.min.js"></script>
    <script src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js"></script>
    <script src="js/common.js"></script>
    <script>
        var activityId = getUrlParamValue("activityId");
        var rank = getUrlParamValue("rank");
        //         $(function () {
        //             var luel = window.location.href;
        //             var url = {'reurl': luel};
        //             $.ajax({
        //                 type: "get",
        //                 url: "http://datahk.yunjy.com.cn/weixin/Weixinshareapi/getsign",
        //                 dataType: "json",
        //                 async: false,
        //                 data: url,
        //                 success: function (data) {
        //                     console.log(data);
        //                     wx.config({
        //                         debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
        //                         appId: data.appid, // 必填，公众号的唯一标识
        //                         timestamp: data.timestamp, // 必填，生成签名的时间戳
        //                         nonceStr: data.noncestr, // 必填，生成签名的随机串
        //                         signature: data.string_js,// 必填，签名
        //                         jsApiList: [//需要调用的JS接口列表
        //                             'checkJsApi',//判断当前客户端版本是否支持指定JS接口
        //                             'onMenuShareTimeline',//分享给好友
        //                             'onMenuShareAppMessage',//分享到朋友圈
        //                             'onMenuShareQQ',//分享到QQ
        //                             'onMenuShareQZone',//分享到朋友圈
        //                         ]
        //                     });
        //                     wx.ready(function () {
        //                         var link = '';
        //                         var protocol = '';
        //
        //                         //分享朋友圈
        //                         wx.onMenuShareTimeline({
        //                             title: '这是一个自定义的标题！',
        //                             link: link,
        //                             imgUrl: protocol,// 自定义图标
        //                             success: function () {
        //                                 // 用户点击了分享后执行的回调函数
        //                             },
        //                         });
        //                         //分享给好友
        //                         wx.onMenuShareAppMessage({
        //                             title: '这是一个自定义的标题！', // 分享标题
        //                             desc: '这是一个自定义的描述这是一个自定义的描述这是一个自定义的描述这是一个自定义的描述！', // 分享描述
        //                             link: link, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
        //                             imgUrl: protocol,// 自定义图标
        //                             type: 'link', // 分享类型,music、video或link，不填默认为link
        //                             dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
        //                             success: function () {
        //                                 // 用户确认分享后执行的回调函数
        //                             },
        //                             cancel: function () {
        //                                 // 用户取消分享后执行的回调函数
        //                             }
        //                         });
        //                         //分享到QQ
        //                         wx.onMenuShareQQ({
        //                             title: '这是一个自定义的标题！', // 分享标题
        //                             desc: '分享测试描述', // 分享描述
        //                             link: link, // 分享链接
        //                             imgUrl: protocol, // 分享图标
        //                             success: function () {
        // // 用户确认分享后执行的回调函数
        //                             },
        //                             cancel: function () {
        // // 用户取消分享后执行的回调函数
        //                             }
        //                         });
        //                         //分享到QQ空间
        //                         wx.onMenuShareQZone({
        //                             title: '这是一个自定义的标题！', // 分享标题
        //                             desc: '分享测试描述', // 分享描述
        //                             link: link, // 分享链接
        //                             imgUrl: protocol, // 分享图标
        //                             success: function () {
        // // 用户确认分享后执行的回调函数
        //                             },
        //                             cancel: function () {
        // // 用户取消分享后执行的回调函数
        //                             }
        //                         });
        //
        //                         wx.error(function (res) {
        //                             alert(res.errMsg);
        //                         });
        //                     });
        //                 },
        //
        //             })
        //         });

    </script>
</head>

<body>
<!--<header class="mui-bar mui-bar-nav ">-->
<!--<a class="mui-action-back mui-icon mui-icon-arrowleft mui-pull-left"></a>-->
<!--<a href="#sheet1" class="mui-icon mui-icon-redo  mui-pull-right"></a>-->
<!--<h1 class="mui-title">项目主页</h1>-->
<!--</header>-->
<div class="mui-content">
    <div class="y-ktyjnr">
        <div class="y-xmzy">
            <div class="y-xmzyimg">
                <img src="" data-preview-src="" data-preview-group="1" class="imgurl">
                <span class="y-hudonzt"></span>
            </div>
            <div class="y-xmzymx">
                <p class="y-xmzybt"></p>
                <p class="y-jieshao"></p>
                <p class='mui-ellipsis y-fbxix'>
                    <span class="y-fbzmz"><i class="iconfont">&#xe643;</i></span>
                    <span class="y-fbsj">发表于 <span class="createDate"></span></span>
                    <span class="y-cyrs">共<span class="partakeNum"></span>人参与</span>
                </p>
                <a href="#sheet2" class="y-fqrgl" id="y-fqrgl" style="display: none">管理</a>
            </div>
        </div>
        <!--新增活动完成程度 2018/7/5-->
        <div id="y-hdwcjd" class="y-hdwcjd">
            <div class="y-tongzi-bt"><b><i class="iconfont">&#xe63c;</i></b></div>
            <div class="y-tongzi-nr">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="y-huanjierwjd">
                                <p>活动完成度 <span style="color: #f7615c" class="complete"></span></p>
                                <p>我的状态 - <span style="color: #ababab" class="state"></span></p>
                                <p>已进行至 - <span style="color: #ff9966" class="result"></span></p>
                            </div>
                        </div>
                        <!--<div class="swiper-slide"><p>我的状态 - <span style="color: #ababab" class="state"></span></p></div>-->
                        <!--<div class="swiper-slide"><p>已进行至 - <span style="color: #ff9966" class="result"></span></p></div>-->
                    </div>
                </div>
            </div>
        </div>
        <!--新增活动完成程度结束 2018/7/5-->
        <div class="navbar-wrapper">
            <div class="y-xmzy-nav"><a class="active">活动介绍</a><a href="#tache">活动环节</a><a>成员列表</a><a>统计</a></div>
        </div>
        <div class="y-xmzydiv">
            <div class="y-xmzy-li active">
                <div class="h-msfxb" style="padding-bottom: 0">
                    <h5><span><i class="iconfont">&#xe64b;</i>基本情况</span></h5>
                    <ul class="mui-table-view y-ktyjnr-mx">
                        <li class="mui-table-view-cell mui-collapse">
                            <p><i class="iconfont">&#xe64c;</i>时间范围: <span class="startTime"></span> 至 <span class="endTime"></span></p>
                        </li>
                        <!--<li class="mui-table-view-cell mui-collapse">-->
                        <!--<p><i class="iconfont endTime">&#xe64c;</i></p>-->
                        <!--</li>-->
                        <li class="mui-table-view-cell mui-collapse">
                            <a class="mui-navigate-right" href="#">
                                <p><i class="iconfont ">&#xe60a;</i>学科学段: <span class="periodAndSubject"></span></p></a>
                            <div class="mui-collapse-content">
                                <p><span class="details"></span></p>
                            </div>
                        </li>
                        <li class="mui-table-view-cell mui-collapse y-ckbmrs">
                            <p><i class="iconfont">&#xe649;</i>报名人数: <span class="y-baomrens"></span>
                                <span class="y-ckcy">（查看全部学员）<i class="iconfont">&#xe611;</i></span>
                            </p>
                        </li>
                    </ul>
                    <!--新增审核通过图章2018/7/5-->
                    <div class="rotateInDownRightDiv" style="display:none;">
                        <div class="y-sktgtz animated rotateInDownRight"><img src="img/sktgtz.png"></div>
                    </div>
                    <!--新增审核通过图章结束2018/7/5-->
                </div>
                <div class="h-msfxb">
                    <h5><span><i class="iconfont">&#xe64b;</i>活动安排</span></h5>
                    <div class="y-fwbnr">
                        <div class="arrangeDetail"></div>
                    </div>
                    <div class="h-msfxb">
                        <div class="y-ktyjnr-fj">

                        </div>
                    </div>

                </div>

                <div class="h-msfxb">
                    <h5><span><i class="iconfont">&#xe64b;</i>最新动态</span></h5>
                    <div class="y-ktyjsyhf">
                        <div class="y-scroll">

                        </div>
                    </div>
                </div>
            </div>
            <div class="y-xmzy-li">
                <div class="h-msfxb">
                    <!--新增参与人数2018/7/5-->
                    <div class="y-weicyury">
                        <span><b><sapn class="noJoin"></sapn>人</b>未参与</span>
                        <span><b><sapn class="nofinish"></sapn>人</b>未完成</span>
                        <span><b><sapn class="finished"></sapn>人</b>已完成</span>
                    </div>
                    <!--新增参与人数结束2018/7/5-->
                    <h5><span><i class="iconfont">&#xe64b;</i>活动环节<a>（共<span class="tacheTotal"></span>个环节）</a></span></h5>
                    <div class="y-hdhj">
                        <ul class="y-hdhj-ul">

                        </ul>
                        <i class="iconfont y-icon">&#xe72e;</i>
                    </div>

                </div>
            </div>
            <div class="y-xmzy-li">
                <div class="h-msfxb">
                    <h5><span><i class="iconfont">&#xe64b;</i>成员列表<a>（共<span class="total"></span>人）</a></span>
                        <span class="y-lbqh">
                                  <a class="active"><i class="iconfont">&#xe663;</i></a>
                                  <a><i class="iconfont">&#xe65e;</i></a></span></h5>
                    <!--新增-->
                    <div class="y-cyfl">
                        <span class="active"><a>全部成员</a></span>
                        <span><a>未参与</a></span>
                        <span><a>未完成</a></span>
                        <span><a>已完成</a></span>
                    </div>
                    <div id="y-sqjrdsh" class="y-sqjrdsh" style="display: none">
                        <img src="img/QQ1.png">
                        <img src="img/Qzone1.png">
                        <img src="img/WeChat1.png">
                        <span>申请加入，待审核（<span class="noAuditNum"></span>人）</span>
                    </div>
                    <!--新增结束-->
                    <div class="y-cylb">

                        <p class="y-cyjs">发起人、管理员(<span class="managerNum"></span>人)</p>
                        <ul class="mui-table-view manager">

                        </ul>

                        <p class="y-cyjs">学员(<span class="studentNum"></span>人) <a class="y-remocy managerAction" style="display: none">删除</a> <a class="y-addcy managerAction"
                                                                                                                                                  style="display: none">新增</a></p>
                        <ul class="mui-table-view student">

                        </ul>
                    </div>
                </div>
            </div>
            <div class="y-xmzy-li">


                <div class="h-msfxb">
                    <h5><span><i class="iconfont">&#xe64b;</i>统计<a>（共<span class="total"></span>人）</a></span></h5>
                    <div class="y-tongji">
                        <h4>活动成员</h4>
                        <p>活动发起人、管理员：<span class="managerNo"></span>人</p>
                        <p>活动成员：<span class="studentNo"></span>人</p>
                        <h4>活动环节:共<span class="tacheNo"></span>个环节</h4>
                        <ul class="y-hdhjtj">

                        </ul>

                    </div>
                </div>
            </div>
            <div class="y-jiewei">闻道有先后，术业有专攻</div>
        </div>
    </div>
</div>
<div class="y-plunsck">
    <div class="y-textdiv">
        <div class="y-textdivspan">
            <span class="y-quexiao">取消</span>
            <span class="y-fabiao">发表</span>
        </div>
        <div class="y-inputframe">
            <textarea rows="5" id="username" class="inputframe" autofocus="autofocus" onKeyUp='keypress()' onblur='keypress()' placeholder="我来说两句"></textarea></div>
    </div>
</div>
<!--新增申请加入2018/7/5-->

<div class="y-sqjrhd animated bounceIn" id="y-sqjrhd" style="display: none">
    <div>
        <p>开放式活动，非成员可申请加入，活动发起人批准后可参与活动环节</p>
    </div>
    <div>
        <button type="button" class="mui-btn mui-btn-primary" id="isTempMember" onclick="jionin();">申请加入</button>
    </div>
</div>
<!--新增申请加入结束2018/7/5-->
<!--*分享弹窗*-->
<div id="sheet1" class="mui-popover mui-popover-bottom mui-popover-action ">
    <div class="y-fxcxlb">
        <span><a><img src="img/WeChat.png"><p>微信</p></a></span>
        <span><a><img src="img/Circle.png"><p>朋友圈</p></a></span>
        <span><a><img src="img/QQ.png"><p>QQ</p></a></span>
        <span><a><img src="img/Qzone.png"><p>QQ空间</p></a></span>
        <span><a><img src="img/Refresh.png"><p>刷新</p></a></span>
        <span><a><img src="img/QR-code.png"><p>二维码</p></a></span>
        <span><a><img src="img/URL.png"><p>链接</p></a></span>
        <span><a><img src="img/complaint.png"><p>举报</p></a></span>
    </div>
    <div class="y-quxiao">
        <a href="#sheet1">取消</a>
    </div>
</div>
<div id="sheet2" class="mui-popover mui-popover-bottom mui-popover-action ">
    <ul class="mui-table-view y-administrate">
        <li class="mui-table-view-cell">
            <a href="#">修改活动</a>
        </li>
        <!--<li class="mui-table-view-cell">-->
        <!--<a href="#">考核设置</a>-->
        <!--</li>-->
        <li class="mui-table-view-cell ">
            <a href="#">成员管理</a>
        </li>
        <li class="mui-table-view-cell ">
            <a href="#">统计与考核</a>
        </li>
    </ul>
    <!-- 取消菜单 -->
    <ul class="mui-table-view">
        <li class="mui-table-view-cell">
            <a href="#sheet2"><b>取消</b></a>
        </li>
    </ul>
</div>
<!--打赏入口-->
<div class="exceptional-entrance">
    <a>打赏</a>
</div>
<div class="draggable">
    <div class="ds-draggable">
        <div class="ds-waike">
            <div class="ds-test animated bounceIn">
                <a href="#popover2">
                    <span class="ds-bot"></span>
                    <span class="ds-top"></span>
                    陪我玩 或者 <em>打赏我>> </em>
                </a>
            </div>
        </div>
        <div><img class="animated animated2 bounceInRight" src="img/0fcc06537b.gif"></div>
        <div class="ds-donghua"><a></a><img src="img/017bf655eceb1232f875a1328330a9.gif"></div>
    </div>
</div>
<!--新增加 打赏 2018/6/11-->
<div id="popover2" class="mui-popover">
    <div class="ds-reward">
        <div class="ds-toux"><img src="img/500373494_wx.jpg"></div>
        <p class="ds-wenan">活动打赏，其实是超越赞的一种表达</p>
        <div class="ds-randomamount"><label>￥</label><span>0.55</span><i class="iconfont animated rotateInDownLeft">&#xe63d;</i></div>
        <div class="ds-input">
            <label>￥</label>
            <input id="test1" type="text" class="mui-input-clear" onkeyup="limitInput(this)" placeholder="最多不超过20元">
        </div>
        <div class="ds-srsj">
            <span class="ds-srsj-a">输入金额</span>
            <span class="ds-srsj-b">随机金额</span></div>
        <div class="ds-qezf"><a>赏</a></div>
        <div class="ds-zffs">
            <p>选择支付方式,<a>支付宝</a></p>
            <button class="animated  ds-zfb">支付宝</button>
            <button class="animated  ds-wx">微信</button>
        </div>
    </div>
</div>
<!--微信分享-->
<div class="y-weixing">
    <div class="y-fengxiang">
        <p>1.点击右上角 "•••"</p>
        <p class="y-xzfxhy">2.选择 " <img src="img/AppMessage.png"> " 发送给朋友</p>
        <div class="y-triangle"></div>
    </div>
</div>
<!--<div id="myiframeparent">-->
<!--<iframe id="myiframefind" src="" frameBorder=0 style="height: 100vh;width: 100%" > </iframe>-->
<!--</div>-->

<script>
    mui.init({
        gestureConfig: {
            tap: true, //默认为true
            doubletap: true, //默认为false
            swipe: false
        }
    });

    //申请加入
    function jionin() {
        var btnArray = ['确认', '取消'];
        mui.confirm('确认加入吗？', '提示', btnArray, function (e) {
            if (e.index == 0) {
                post("/activity/member/apply", {activityId: getUrlParamValue("activityId")}, function (res) {
                    if (res.code == 200) {
                        mui.toast('申请成功');
                    }
                    else {

                        mui.toast(res.message);
                    }
                });

            } else {

                mui.toast('你取消了申请');
            }
        });
    }


    $(function () {
        // 顶部活动详情页
        get("/activity/detail?activityId=" + activityId, function (res) {
            if (res.code == 200) {
                var data = res.data;
                if (Object_filter(data)) {
                    if (res.data.state == 1) {
                        $(".y-hudonzt").addClass('y-hudonzt-wks').html('未开始');
                    } else if (res.data.state == 2) {
                        $(".y-hudonzt").addClass('y-hudonzt-jxz').html('进行中');
                    } else {
                        $(".y-hudonzt").addClass('y-hudonzt-yjs').html('已结束');
                    }
                    $(".imgurl").attr("src", res.data.img);
                    $('.y-xmzybt').html(res.data.title);
                    $('.y-jieshao').html(res.data.describe);
                    $('.y-xmzybt').html(res.data.title);
                    $('.partakeNum').html(res.data.partakeNum);
                    $('.y-fbzmz').html(res.data.publisher);
                    $('.createDate').html(res.data.publishDate);
                    // var stringTime = res.data.publishDate;
                    // var timestamp2 = Date.parse(new Date(stringTime));
                    // var todayString = new Date();
                    // var today = Date.parse(new Date(todayString));
                    //
                    // var days = parseInt((today - timestamp2) / 1000 / 60 / 24 / 60);
                    // if (days == 0)
                    //     $('.createDate').html(res.data.publishDate);
                    // else
                    //     $('.createDate').html(days + '天前');
                }

            }
        });

        // 顶部滚动栏
        get("/activity/roll?activityId=" + activityId, function (res) {
            if (res.code == 200) {
                var data = res.data;
                if (Object_filter(data)) {
                    $('.complete').html((res.data.completionRate) + '%');
                    if (res.data.state == 1) {
                        $('.state').html('已完成').css('color', '#50db64');
                        $('.rotateInDownRightDiv').show();
                    } else {
                        $('.state').html('待完成');
                    }
                    if(res.data.progress==null||res.data.progress==''){
                        $('.result').html('无环节');
                    }else{
                        $('.result').html(res.data.progress).attr('data-id', res.data.progressId);
                    }

                    if (Math.ceil(res.data.completionRate) == 100) {
                        $('.result').html('已完成');
                    }
                }

            }
        });


        get("/activity/auditMemberNum?activityId=" + activityId, function (res) {

            if (res.code == 200) {
                $(".noAuditNum").html(res.data.total);
            }
        });

        //成员列表
        get("/activity/memberList?activityId=" + getUrlParamValue("activityId"), function (res) {
            if (res.code == 200) {
                var data = res.data;
                var managerNum = 0, studentNum = data.total;
                if (Object_filter(data)) {
                    $(".total").html(data.total);
                    var div = "";
                    var li = "";
                    for (var i = 0; i < data.memberList.length; i++) {
                        if (data.memberList[i].rank == 1) {
                            div += '<li class="mui-table-view-cell mui-media">' +
                                '<a href="javascript:;">' +
                                '<img class="mui-media-object mui-pull-left" src="' + data.memberList[i].img + '">' +
                                '<div class="mui-media-body"><span class="y-cymc">' + data.memberList[i].name + '</span>' +
                                '<span class="y-cylx y-fqr rank">发起人</span>' +
                                '<span class="y-cylx y-zj">' + data.memberList[i].identity + '</span>' +
                                '<p class="mui-ellipsis"><span>资源数：' + data.memberList[i].resourseNum + '</span>' +
                                '<span>帖子数：' + data.memberList[i].noteNum + '</span></p></div></a></li>';
                            managerNum++;
                        }else{
                            li += '<li  class="mui-table-view-cell mui-media" ' +
                                'data-id="' + data.memberList[i].id + '">' +
                                '<a href="javascript:;">' +
                                '<img class="mui-media-object mui-pull-left" src="' + data.memberList[i].img + '">' +
                                '<div class="mui-media-body"><span class="y-cymc">' + data.memberList[i].name + '</span>' +
                                '<span class="y-cylx y-xy">学员</span>' +
                                '<span class="y-cylx y-bzr">' + data.memberList[i].identity + '</span>' +
                                '<p class="mui-ellipsis"><span>资源数：' + data.memberList[i].resourseNum + '</span>' +
                                '<span>帖子数：' + data.memberList[i].noteNum + '</span></p></div></a></li>';
                        }


                    }
                    $(".manager").append(div);
                    $(".student").append(li);
                    $(".managerNum").html(managerNum);
                    $(".studentNum").text(studentNum-1);
                }
            }

        });


        //统计列表
        get("/activity/statistics?activityId=" + getUrlParamValue("activityId"), function (res) {

            if (res.code == 200) {
                var data = res.data;
                if (Object_filter(data)) {
                    $(".total").text(data.total);
                    $(".managerNo").html(data.adminNum);
                    $(".studentNo").html(data.memberNum);
                    $(".tacheNo").html(data.tacheNum);
                    var div = '';
                    for (var i = 0; i < data.list.length; i++) {
                        var a = "";
                        for (var j = 0; j < data.list[i].itemList.length; j++) {
                            a += '<a><span>' + data.list[i].itemList[j].num + '</span><p>' + data.list[i].itemList[j].item + '</p></a>';
                        }
                        div += '<li> <div class="y-hdhjmc">' + data.list[i].title + '</div><div class="y-hdhjsl">' + a + '</div></li>';
                    }
                    $(".y-hdhjtj").append(div);
                }

            }

        });

        // 活动基本情况
        get("/activity/basicSituation?activityId=" + activityId, function (res) {
            if (res.code == 200) {
                var data = res.data;
                if (Object_filter(data)) {
                    $(".startTime").after(data.startDate);
                    $(".endTime").after(data.endDate);
                    $(".periodAndSubject").after(data.periodAndSubject);
                    $(".details").after(data.details);
                    $(".y-baomrens").text(data.enrollNumber);
                }
            }
        });

        // 活动安排
        get("/activity/activityArrange?activityId=" + activityId, function (res) {
            if (res.code == 200) {
                var data = res.data;
                if (Object_filter(data)) {
                    $(".arrangeDetail").html(data.arrangeDetail);
                    var attachmentList = data.attachmentList;
                    var a = "";
                    var color = '#00acda';
                    for (var i = 0; i < attachmentList.length; i++) {
                        if (attachmentList[i].ext == 'pdf') {
                            color = '#f44c4c';
                        }
                        a += '<a class="y-fjlx" ><div class="y-fjlx-img" style="background-color: ' + color + '">' + attachmentList[i].ext + '</div><div class="y-fjlx-xp"><p>' + attachmentList[i].title + '</p><p>' + attachmentList[i].size + '</p>' +
                            '</div><div class="y-fjlx-cz"><button type="button" class="mui-btn mui-btn-primary mui-btn-pdf" >预览</button></div></a>';
                    }
                    $(".y-ktyjnr-fj").append(a);
                }
            }
        });
//活动安排---附件
        get("/activity/getResourceByOrigin?origin=5&originId=" + activityId, function (res) {

            if (res.code == 200) {
                var data = res.data;
                if (Object_filter(data)) {
                    var attachmentList = data.attachmentList;
                    var a = "";
                    var color = '#f44c4c';
                    for (var i = 0; i < attachmentList.length; i++) {
                        var str = attachmentList[i].name;
                        var index = str.lastIndexOf(".");
                        str = str.substring(index + 1, str.length);
                        // alert(str);
                        a += '<a class="y-fjlx" data-id="' + attachmentList[i].id + '"><div class="y-fjlx-img" style="background-color: ' + color + '">' + str + '</div><div class="y-fjlx-xp"><p>' + attachmentList[i].name + '</p><p>' + attachmentList[i].size + 'M</p>' +
                            '</div><div class="y-fjlx-cz"><button type="button" class="mui-btn mui-btn-primary mui-btn-pdf" data-id="' + attachmentList[i].fileId + '">预览</button></div></a>';
                    }
                    $(".y-ktyjnr-fj").append(a);
                }
            }
        });

        // 最新动态
        get("/activity/newDynamic?activityId=" + activityId, function (res) {
            if (res.code == 200) {
                var data = res.data;
                if (Object_filter(data)) {
                    var div = "";
                    var dynamicList = data.dynamicList;
                    for (var i = 0; i < dynamicList.length; i++) {
                        var dt = '';
                        switch (dynamicList[i].type) {
                            case ("ACTIVITY"):
                                dt = '<p>' + dynamicList[i].title + '《' + dynamicList[i].noteUrl + '》' + '</p>'
                                break;
                            case ("RESOURCE"):
                                dt = '<p>' + dynamicList[i].title + '《' + dynamicList[i].noteUrl + '》' + '</p>'
                                break;
                            case("TEACH_ARTICLE"):
                                dt = '<p>' + dynamicList[i].title + '《' + dynamicList[i].noteUrl + '》' + '</p>'
                                break;
                            case("TRAIN_GROUP_MEMBER"):
                                dt = '<p>' + dynamicList[i].title + '</p>'
                                break;
                            case("HOMEWORK"):
                                dt = '<p>' + dynamicList[i].title + '《' + dynamicList[i].noteUrl + '》' + '</p>'
                                break;
                            case("TOPIC"):
                                dt = '<p>' + dynamicList[i].title + '《' + dynamicList[i].noteUrl + '》' + '</p>'
                                break;
                        }
                        div += '<div class="y-card"><div class="mui-card"><div class="mui-card-header mui-card-media"><img src="' + dynamicList[i].userImg + '"/>' +
                            '<div class="mui-media-body">' + dynamicList[i].userName + '<p>发表于 ' + dynamicList[i].createDate + '</p></div></div><div class="mui-card-content"><div class="y-card-content"><div class="y-card-img">' +
                            // '<img src="http://hk.yunjy.com.cn/files/course/2017/07-12/14295531e7cd462323.png">' +
                            '</div><div class="y-content">' + dt + '</div></div>' +

                            '</div></div>';
                    }
                    $(".y-scroll").append(div);
                }
            }
        });


        // 未参与、已参与、已完成人数
        get("/activity/flow?activityId=" + getUrlParamValue("activityId"), function (res) {
            if (res.code == 200) {
                var data = res.data;
                if (Object_filter(data)) {
                    $(".noJoin").html(data.noJoinNum);
                    $(".nofinish").html(data.noCompleteNum);
                    $(".finished").html(data.completeNum);
                }
            }
        });

        getUserPower(getUrlParamValue("activityId"), function (role) {
            if (role == 0) {
                $("#y-sqjrhd").show();
                get("/activity/isTempMember?activityId=" + activityId, function (res) {
                    if (res.code == 200) {
                        if (res.data.isTempMember == 1) {
                            $("#isTempMember").html("审批中");
                            $("#isTempMember").attr("disabled", "disabled");
                        }
                    }
                })
            }
            if (role == 2) {
                $("#y-fqrgl").show();
                $("#y-sqjrdsh").show();
                $(".managerAction").show();
            }
        });
    });

    function addRow(rowData) {

        var table = document.body.querySelector('.y-hdhj-ul');
        var li = document.createElement('li');
        var tacheSimpleName = "<i class='iconfont'>&#xe6a1;</i>";
        var tacheName = rowData.generalize;
        var dataUrl = "";
        var lj = rowData.tacheBaseId;
        var tacheId = rowData.tacheId;
        //我的完成情况
        var enableRule = rowData.enableRule;//考核是否开启
        var finishCount = rowData.finishCount;
        var totalCount = rowData.totalCount;
        var mySituation = '';
        //全部完成情况
        var allSituation = '';
        var memberFinishCount = rowData.memberFinishCount;
        var members = rowData.members;
        // alert("完成了"+finishCount);
        // alert('共'+totalCount);
        //如果考核关闭，全部完成情况默认为全部完成。



        var yaoqiu = '';
        if (lj == 11) {
            // tacheSimpleName = "情景";
            dataUrl = 'activityLink/html/underside_qjdr.html?tacheName=' + tacheName;
            yaoqiu = '<p class="y-hdhjyq"><span>完成要求：</span></p><div class="w-wcyq' + tacheId + '">' +
                '<p>1、要求所有成员浏览查看本环节所有内容</p>' +
                '<p>2、每人提交<span class="w-val qjdrPerComment' + tacheId + '">0</span>篇评论</p>' +
                '</div>';
        } else if (lj == 12) {
            // tacheSimpleName = "研讨";
            dataUrl = 'activityLink/html/underside_ztyt.html?tacheName=' + tacheName;
        } else if (lj == 13) {
            //tacheSimpleName = "课程";
            dataUrl = 'activityLink/html/underside_kcxx.html?tacheName=' + tacheName;
        } else if (lj == 14) {
            //tacheSimpleName = "课程2";
            dataUrl = 'activityLink/html/underside_kcxx2.html?tacheName=' + tacheName;
        } else if (lj == 15) {
            // tacheSimpleName = "作业";
            dataUrl = 'activityLink/html/underside_zy.html?tacheName=' + tacheName;
        } else if (lj == 16) {
            //tacheSimpleName = "成果";
            dataUrl = 'activityLink/html/underside_hdcg.html?tacheName=' + tacheName;
            yaoqiu = '<p class="y-hdhjyq"><span>完成要求：</span></p><div class="w-wcyq' + tacheId + '">' +
                '<p>1、要求所有成员浏览查看本环节所有内容</p>' +
                '<p>2、每人提交<span class="w-val hdcgPerComment' + tacheId + '">0</span>篇成果</p>' +
                '</div>';
        } else if (lj == 17) {
            //tacheSimpleName = "答疑";
            dataUrl = 'activityLink/html/underside_hddy.html?tacheName=' + tacheName;
        } else if (lj == 18) {
            // tacheSimpleName = "讨论";
            dataUrl = 'activityLink/html/underside_tlq.html?tacheName=' + tacheName;
            yaoqiu = '<p class="y-hdhjyq"><span>完成要求：</span></p><div class="w-wcyq' + tacheId + '">' +
                '<p>1、要求所有成员浏览查看本环节所有内容</p>' +
                '<p>2、每人提交<span class="w-val perTopic' + tacheId + '">0</span>篇新发帖</p>' +
                '<p>3、回复他人帖子<span class="w-val perReplyTopic' + tacheId + '">0</span>篇</p>' +
                '<p>4、发帖被评为精华<span class="w-val perTopicElite' + tacheId + '">0</span>篇</p>' +
                '</div>';
        } else if (lj == 21) {
            //tacheSimpleName = "组长";
            dataUrl = 'activityLink/html/underside_zzxj.html';
        } else if (lj == 22) {
            //tacheSimpleName = "坊主";
            dataUrl = 'activityLink/html/underside_fzxj.html';
        } else if (lj == 23) {
            // tacheSimpleName = "观摩";
            dataUrl = 'activityLink/html/underside_klgm.html?tacheName=' + tacheName;
        } else if (lj == 24) {
            //tacheSimpleName = "研讨";
            dataUrl = 'activityLink/html/underside_2add2.html?tacheName=' + tacheName;
        } else if (lj == 25) {
            //tacheSimpleName = "互评";
            dataUrl = 'activityLink/html/underside_2add2.html?tacheName=' + tacheName;
        }

        var x = '';
        if (enableRule == false) {
            if (finishCount == 0) {
                x ='<div class="y-hdhjzt"><p>我的状态-<span class="y-wtj">未提交</span> </p><p>|</p><p>全部完成情况<span class="y-ywc">' + members + '</span>/<span class="y-wwc">' + members + '</span></p></div>';

            } else {
                x ='<div class="y-hdhjzt"><p>我的状态- <span class="y-ytj">已提交</span> </p><p>|</p><p>全部完成情况<span class="y-ywc">' + members + '</span>/<span class="y-wwc">' + members + '</span></p></div>';
            }

        } else if (enableRule == true) {
            if (totalCount == finishCount) {
                x = yaoqiu + '<div class="y-hdhjzt"><p>我的完成情况-已完成<span class="y-ywc">' + finishCount + '</span>/<span class="y-ywc">' + totalCount + '</span></p><p>|</p><p>全部完成情况<span class="y-ywc">' + memberFinishCount + '</span>/<span class="y-wwc">' + members + '</span></p></div>';

            } else {
                mySituation = '';
                allSituation = '';
                x = yaoqiu + '<div class="y-hdhjzt"><p>我的完成情况-未完成<span class="y-ywc">' + finishCount + '</span>/<span class="y-wwc">' + totalCount + '</span></p><p>|</p><p>全部完成情况<span class="y-ywc">' + memberFinishCount + '</span>/<span class="y-wwc">' + members + '</span></p></div>';

            }
        }


        li.innerHTML = '<div id="tache-div-' + tacheId + '" class="y-hdhj-lc" tache-id="' + tacheId + '" data-url="' + dataUrl + '"><div class="y-hdhjtb"><span>' + tacheSimpleName
            + '</span></div><div class="y-hdhjjs">' + rowData.generalize
            + '<p class="y-hdhjms">' + rowData.tacheDetail
            + '</p>'
            + x + '</div></div>';

        table.appendChild(li);
        // 获取描述
        get("/activity/describe?tacheType=" + tacheId + "&activityId=" + getUrlParamValue("activityId"), function (res) {
            if (res.code == 200) {
                var actRule = res.data.actRule;
                if (Object_filter(actRule)) {
                    if (actRule.status == 1) {
                        if (lj == 18) {
                            // 讨论区
                            $(".perTopic" + tacheId + "").html(actRule.perTopic);                 // 发布数量
                            $(".perReplyTopic" + tacheId + "").html(actRule.perReplyTopic);       // 回复数量
                            $(".perTopicElite" + tacheId + "").html(actRule.perTopicElite);      // 加精资源
                            // 空或者等于0时隐藏
                            if (!Object_filter(actRule.perTopic) || actRule.perTopic == 0) {
                                $(".perTopic" + tacheId + "").parent().hide();
                            }
                            if (!Object_filter(actRule.perReplyTopic) || actRule.perReplyTopic == 0) {
                                $(".perReplyTopic" + tacheId + "").parent().hide();
                            }
                            if (!Object_filter(actRule.perTopicElite) || actRule.perTopicElite == 0) {
                                $(".perTopicElite" + tacheId + "").parent().hide();
                            }
                        } else if (lj == 11) {
                            // 情景导入
                            $(".qjdrPerComment" + tacheId + "").html(actRule.perComment); // 发布数量
                            // 空或者等于0时隐藏
                            if (!Object_filter(actRule.perComment) || actRule.perComment == 0) {
                                $(".qjdrPerComment" + tacheId + "").parent().hide();
                            }
                        } else if (lj == 16) {
                            // 活动成果
                            $(".hdcgPerComment" + tacheId + "").html(actRule.perComment);
                            // 空或者等于0时隐藏
                            if (!Object_filter(actRule.perComment) || actRule.perComment == 0) {
                                $(".hdcgPerComment" + tacheId + "").parent().hide();
                            }
                        }
                    } else {
                        $(".w-wcyq" + tacheId).hide();
                        $(".w-wcyq" + tacheId).prev().hide();
                    }
                }
            }
        })
    }

</script>
<script>
    mui.previewImage();
</script>
<script>
    var studioId = getUrlParamValue("studioId");
    //新增成员
    mui('.y-cyjs').on('tap', '.y-addcy', function () {
        var memberIds = '';
        $(".student").find('li').each(function () {
            if (Object_filter($(this).attr("data-id"))) {
                memberIds += $(this).attr("data-id") + ",";
            }
        });
        memberIds = memberIds.substr(0,memberIds.length-1);
       
        mui.openWindow({
            url: 'choose_user.html?activityId=' + activityId + '&studioId=' + studioId + "&memberIds=" + memberIds + "&add=add",
            id: ''
        });
    });
    //删除成员
    mui('.y-cyjs').on('tap', '.y-remocy', function () {
        mui.openWindow({
            url: 'delete_user.html?activityId=' + activityId,
            id: ''
        });
    });
    //$.swipeoutOpen(el,direction)//打开指定列的滑动菜单，el:指定列的dom对象，direction：取值left|right，指定打开的是左侧或右侧滑动菜单
    //$.swipeoutClose(el);//关闭指定列的滑动菜单，el:指定列的dom对象


    //左滑删除成员
    /*  $('.y-cylb').on('tap', '.mui-btn', function (event) {
          var elem = this;
          var li = elem.parentNode.parentNode;
          mui.confirm('确认删除该条记录？', '提示', btnArray, function (e) {
              if (e.index == 0) {

              } else {
                  setTimeout(function () {
                      $.swipeoutClose(li);
                  }, 0);
              }
          });
      });
      var btnArray = ['确认', '取消'];
  */
</script>
<script>
    //管理
    mui('.y-administrate').on('tap', 'li', function () {
        mui('#sheet2').popover('toggle');
        var index = $(".y-administrate li").index(this);
        if (index == 0) {
            //修改活动
            mui.openWindow({
                url: 'add_activity.html?activityId=' + getUrlParamValue("activityId") + "&studioId=" + getUrlParamValue("studioId"),
                id: ''
            });
        } else if (index == 1) {
            //成员管理
            $('.y-xmzy-nav').find('a').removeClass("active");
            $('.y-xmzy-nav').find('a').eq(2).addClass("active");
            $('.y-xmzydiv').find('.y-xmzy-li').hide();
            $('.y-xmzydiv').find('.y-xmzy-li').eq(2).show();
        } else if (index == 2) {
            //统计
            $('.y-xmzy-nav').find('a').removeClass("active");
            $('.y-xmzy-nav').find('a').eq(3).addClass("active");
            $('.y-xmzydiv').find('.y-xmzy-li').hide();
            $('.y-xmzydiv').find('.y-xmzy-li').eq(3).show();

        } else if (index == 3) {

            //考核设置
            mui.openWindow({
                url: 'inspection_setup.html',
                id: ''
            });
        }

    });

    //打开成员列表
    mui('.y-ktyjnr-mx').on('tap', '.y-ckbmrs', function () {
        // mui.openWindow({
        //     url: 'member_list.html?activityId= ' + activityId,
        //     id: ''
        // });
        //成员管理
        $('.y-xmzy-nav').find('a').removeClass("active");
        $('.y-xmzy-nav').find('a').eq(2).addClass("active");
        $('.y-xmzydiv').find('.y-xmzy-li').hide();
        $('.y-xmzydiv').find('.y-xmzy-li').eq(2).show();
    });
    //打开审核成员列表
    var ybtn = document.getElementById("y-sqjrdsh");
    //监听点击事件
    ybtn.addEventListener("tap", function () {
        mui.openWindow({
            url: 'audit_member.html?activityId=' + activityId,
            id: ''
        });
    });
</script>

<script>
    mui(".y-ktyjnr-fj").on('tap', '.mui-btn-pdf', function () {
        mui.openWindow({
            url: transcodingUrl + $(this).attr("data-id"),
            id: ''
        });
    })
</script>
<script>
    //列表切换
    mui('.y-lbqh').on('tap', 'a', function () {
        var z = $(this).index();
        $('.y-lbqh').find('a').removeClass('active');
        $(this).addClass('active');
        if (z == 0) {
            $('.y-cylb').find('.mui-table-view').removeClass('y-table-view');
        } else if (z == 1) {
            $('.y-cylb').find('.mui-table-view').addClass('y-table-view');
        }
    })
</script>
<script>

    var elem = document.querySelector('.draggable');
    var draggie = new Draggabilly(elem);

    function onDragMove(instance, event, pointer) {
    }

    // bind event listener
    draggie.on('dragMove', onDragMove);
    console.log('开始前');
    // un-bind event listener
    draggie.off('dragMove', onDragMove);
    console.log('介绍');
    // return true to trigger an event listener just once
    draggie.on('dragMove', function () {
        $('.draggable').css('bottom', 'auto');
        var styles = $('.draggable').css(['width', 'height', 'backgroundColor', 'transform']);
        if (parseInt(styles.left) > 390) {

        }
        console.log('获取到的宽度值为：' + styles.width);
        console.log('获取到的高度值为：' + styles.height);
        console.log('获取到的背景色为：' + styles.backgroundColor);
        console.log('右边：' + styles.transform);
    });
    mui(".exceptional-entrance").on('tap', 'a', function () {
        $('.exceptional-entrance').addClass('animated bounceOutRight').removeClass('bounceInRight');
        //  $('.exceptional-entrance-jh').delay(500).show(0);
        //   $('.exceptional-entrance-jh').delay(2600).hide(0);
        $('.draggable').delay(500).show(0);
        $('.animated2').delay(500).show(0);
        $('.animated2').delay(2500).hide(0);
        $('.ds-waike').delay(3500).show(0);
        $('.ds-donghua').delay(3200).show(0);

    });
    mui("body").on('tap', '.mui-content', function () {
        $('.draggable').hide();
        $('.ds-waike').hide();
        $('.ds-donghua').hide();
        $('.exceptional-entrance').addClass(' bounceInRight').removeClass('bounceOutRight');
    });

</script>
<script>
    var browser = {
        versions: function () {
            var u = navigator.userAgent,
                app = navigator.appVersion;
            return {         //移动终端浏览器版本信息
                trident: u.indexOf('Trident') > -1, //IE内核
                presto: u.indexOf('Presto') > -1, //opera内核
                webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
                gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
                mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
                ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
                android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
                iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
                iPad: u.indexOf('iPad') > -1, //是否iPad
                webApp: u.indexOf('Safari') == -1 //是否web应该程序，没有头部与底部
            };
        }(),
        language: (navigator.browserLanguage || navigator.language).toLowerCase()
    }

    if (browser.versions.mobile) {//判断是否是移动设备打开。browser代码在下面
        var ua = navigator.userAgent.toLowerCase();//获取判断用的对象
        if (ua.match(/MicroMessenger/i) == "micromessenger") {
//在微信中打开
            mui('.y-fxcxlb').on('tap', 'span', function () {
                var index = $(".y-fxcxlb span").index(this);
                mui(this).popover('toggle');
                $('.mui-backdrop').hide();
                $('.y-weixing').show();
                if (index == 0) {
                    $('.y-xzfxhy').html('2.选择 " <img src="img/AppMessage.png"> " 发送给朋友')
                } else if (index == 1) {
                    $('.y-xzfxhy').html('2.选择 " <img src="img/Timeline.png"> " 分享到朋友圈')
                } else if (index == 2) {
                    $('.y-xzfxhy').html('2.选择 " <img src="img/ShareQQ.png"> " 分享到手机QQ')
                } else if (index == 3) {
                    $('.y-xzfxhy').html('2.选择 " <img src="img/ShareQZone.png"> " 分享到QQ空间')
                } else {
                    $('.y-weixing').hide();
                    mui.toast('功能开发中...敬请期待', {duration: '1000', type: 'div'})
                }
                setTimeout(function () {
                    $('.y-weixing').hide();
                }, 3000)
            })
//window.location.href="{ctx}/"
        } else if (ua.match(/WeiBo/i) == "weibo") {
//在新浪微博客户端打开
        } else if (ua.match(/QQ/i) == "qq") {
//在QQ空间打开
            mui('.y-fxcxlb').on('tap', 'span', function () {
                var index = $(".y-fxcxlb span").index(this);
                mui(this).popover('toggle');
                $('.mui-backdrop').hide();
                $('.y-weixing').show();
                if (index == 0) {
                    $('.y-xzfxhy').html('2.选择 " <img src="img/AppMessage.png"> " 发送给朋友')
                } else if (index == 1) {
                    $('.y-xzfxhy').html('2.选择 " <img src="img/Timeline.png"> " 分享到朋友圈')
                } else if (index == 2) {
                    $('.y-xzfxhy').html('2.选择 " <img src="img/ShareQQ.png"> " 分享到手机QQ')
                } else if (index == 3) {
                    $('.y-xzfxhy').html('2.选择 " <img src="img/ShareQZone.png"> " 分享到QQ空间')
                } else {
                    $('.y-weixing').hide();
                    mui.toast('功能开发中...敬请期待', {duration: '1000', type: 'div'})
                }
                setTimeout(function () {
                    $('.y-weixing').hide();
                }, 3000)
            })
        } else if (/alipay/ig.test(ua)) {
            mui.alert("支付宝");
        } else if (browser.versions.ios) {
//是否在IOS浏览器打开
            mui('.y-fxcxlb').on('tap', 'span', function () {
                var index = $(".y-fxcxlb span").index(this);
                mui(this).popover('toggle');
                $('.mui-backdrop').hide();
                if (index <= 3) {
                    $('.y-weixing').show().addClass('active');
                    $('.y-fengxiang').html('<P>请使用浏览器的分享功能把好东西分享给朋友</P> <div class="lnqactive"></div>');
                    setTimeout(function () {
                        $('.y-weixing').hide();
                    }, 3000)
                } else if (index > 3) {
                    $('.y-weixing').hide();
                    mui.toast('功能开发中...敬请期待', {duration: '1000', type: 'div'});
                    setTimeout(function () {
                        $('.y-weixing').hide();
                    }, 3000)
                }

            });
        } else if (browser.versions.android) {
//是否在安卓浏览器打开
            mui('.y-fxcxlb').on('tap', 'span', function () {
                var index = $(".y-fxcxlb span").index(this);
                mui(this).popover('toggle');
                $('.mui-backdrop').hide();
                if (index <= 3) {
                    $('.y-weixing').show().addClass('active');
                    $('.y-fengxiang').html('<P>请使用浏览器的分享功能把好东西分享给朋友</P> <div class="lnqactive"></div>');
                    setTimeout(function () {
                        $('.y-weixing').hide();
                    }, 3000)
                } else if (index > 3) {
                    $('.y-weixing').hide();
                    mui.toast('功能开发中...敬请期待', {duration: '1000', type: 'div'});
                    setTimeout(function () {
                        $('.y-weixing').hide();
                    }, 3000)
                }

            });
        }
    } else {
//否则就是PC浏览器打开
        $('.y-weixing').show().addClass('active');
        $('.y-fengxiang').html('<P>请使用浏览器的分享功能把好东西分享给朋友</P> <div class="lnqactive"></div>');
        setTimeout(function () {
            $('.y-weixing').hide();
        }, 3000)
    }
</script>
<script>
    //所有成员 未参与 未完成 已完成
    mui('.y-cyfl').on('tap', 'span', function () {
        $('.y-cyfl').find('span').removeClass('active');
        $(this).addClass('active');
    })
</script>
<script>
    //点赞 评论 打赏
    mui('.y-scroll').on('tap', '.y-zps a', function () {
        var index = $(this).index();
        if (index == 0) {
            //点赞动画
            $(this).find('.iconfont').toggle();
            $(this).toggleClass('animated bounceIn actvit');

            $(this).nextAll('.y-zdrs').toggle().toggleClass('animated fadeInDown');
            ;


        } else if (index == 1) {
            //评论操作
            /* mui.openWindow({
             url:'评论操作.html',
             id:'评论操作id'
             });*/
        }
        else if (index == 2) {
            //打赏操作
            /*mui.openWindow({
             url:'打赏',
             id:'打赏id'
             });*/
        }
    });
</script>
<script>
    //打赏.. 2018/04/11
    //初始化随机数
    var num = Math.random();//随机数
    var newNum = num.toFixed(2);//0到1之间的,保留两位小数点
    if (newNum == 0) {
        $('.ds-randomamount span').text('0.01');//如果为0时候就默认为0.01元
    } else {
        $('.ds-randomamount span').text(newNum);
    }
    //随机数
    mui(".ds-randomamount").on('tap', 'i', function () {
        $(this).toggleClass('rotateInDownLeft rotateInUpRight');

        var num = Math.random();//随机数
        var newNum = num.toFixed(2);//0到1之间的,保留两位小数点
        if (newNum == 0) {
            $('.ds-randomamount span').text('0.01');
            mui.alert('0');
        } else {
            $('.ds-randomamount span').text(newNum);
        }

    });
    //输入金额
    mui(".ds-srsj").on('tap', '.ds-srsj-a', function () {
        $(this).hide();
        $('.ds-srsj-b').show();
        $('.ds-randomamount').hide();
        $('.ds-input').show();
    });
    //随机金额
    mui(".ds-srsj").on('tap', '.ds-srsj-b', function () {
        $(this).hide();
        $('.ds-srsj-a').show();
        $('.ds-randomamount').show();
        $('.ds-input').hide();
//重新初始化随机数
        var num = Math.random();//随机数
        var newNum = num.toFixed(2);//0到1之间的,保留两位小数点
        if (newNum == 0) {
            $('.ds-randomamount span').text('0.01');
            mui.alert('0');
        }
        $('.ds-randomamount span').text(newNum);
    });

    //只能输入数字小数点精确到小数点后两位
    function limitInput(o) {
        o.value = o.value.replace(/[^\d.]/g, ""); //清除"数字"和"."以外的字符
        o.value = o.value.replace(/^\./g, ""); //验证第一个字符是数字
        o.value = o.value.replace(/0\.\d\{2}/);
        o.value = o.value.replace(/\.{2,}/g, "."); //只保留第一个, 清除多余的
        o.value = o.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        o.value = o.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3'); //只能输入两个小数
        if (o.value.indexOf(".") < 0 && o.value != "") {//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
            o.value = parseFloat(o.value);
        }
        var value = o.value;
        var min = 0;//最小金额
        var max = 20;//最大金额
        if (parseInt(value) < min || parseInt(value) >= max) {
            o.value = '20';
        }
    }

    //选择支付方式
    mui(".ds-zffs").on('tap', 'a', function () {
        $('.ds-zffs button').show();
        $('.ds-zffs button').addClass('flipInX');
    });
    mui(".ds-zffs").on('tap', 'button', function () {
        var t = $(this).text();
        $('.ds-zffs a').text(t);
    });
    //打赏.. 2018/04/12 结束
</script>
<script type="text/javascript">
    //initiating jQuery
    jQuery(function ($) {
        $(document).ready(function () {
            //enabling stickUp on the '.navbar-wrapper' class
            $('.navbar-wrapper').stickUp();
        });
    });

</script>
<script>
    get("/activity/flow?activityId=" + activityId, function (res) {
        if (res.code == 200) {
            $(".y-hdhj-ul").html("");
            $(".tacheTotal").html(res.data.tacheTotal);

            var data = res.data;
            var list = data.tacheList;
            if (Object_filter(list)) {
                $.each(list, function (i, v) {
                    addRow(list[i]);
                });
            }
            var hashId = location.hash;
            if (Object_filter(hashId)) {
                $("html,body").animate({scrollTop: $(hashId).offset().top}, 500);
            }
        }
    });

    //活动环节列表2018/7/6
    mui('.y-hdhj-ul').on('tap', '.y-hdhj-lc', function () {

        var tacheId = $(this).attr("tache-id");

        var dataUrl = $(this).attr("data-url") + "&activityId=" + activityId + "&tacheType=" + tacheId;
        // window.history.replaceState(null, null, window.location.href+"#tache-div-"+tacheId);
        mui.openWindow({
            url: dataUrl,
            id: ''
        });
        // console.log('pjax打印');
        // $.pjax({
        //     url: dataUrl,
        //     container: '#y-pjax'
        // });
        // window.open(dataUrl);
    });
    //就行至活动环节
    document.getElementById("y-hdwcjd").addEventListener("tap", function () {
        var progressId = $(".result").attr("data-id");
        var prodataUrl = $(".y-hdhj-lc[tache-id=" + progressId + "]").attr("data-url") + "&activityId=" + activityId + "&tacheType=" + progressId;
        console.log(progressId);
        console.log(prodataUrl);
        var a = $('.state').html();
        // alert("测试"+a);
        if (a == '待完成') {
            mui.openWindow({
                url: prodataUrl,
                id: ''
            });
        } else {
            $('.y-xmzy-nav').find('a').removeClass("active");
            $('.y-xmzy-nav').find('a').eq(1).addClass("active");
            $('.y-xmzydiv').find('.y-xmzy-li').hide();
            $('.y-xmzydiv').find('.y-xmzy-li').eq(1).show();
        }

    });
    //选项卡切换
    $(function () {
        //获取：
        var acolor = localStorage.getItem("mycolor");
        var PreviousMenu = localStorage.getItem("PreviousMenu");
        $('.y-xmzy-nav').find('a').removeClass("active");
        $('.y-xmzy-nav').find('a').eq(PreviousMenu).addClass("active");
        $('.y-xmzydiv').find('.y-xmzy-li').hide();
        $('.y-xmzydiv').find('.y-xmzy-li').eq(PreviousMenu).show();
        mui.scrollTo(acolor, 100);
    });

    mui('.y-xmzy-nav').on('tap', 'a', function () {
        var a = $(this).index();
        $('.y-xmzy-nav').find('a').removeClass("active");
        $(this).addClass("active");
        $('.y-xmzydiv').find('.y-xmzy-li').hide();
        $('.y-xmzydiv').find('.y-xmzy-li').eq(a).show();
        localStorage.setItem("PreviousMenu", a);//保存到本地
    });
    //获取滑动距离
    $(window).scroll(function () {
        var scroll = $(window).scrollTop();
        localStorage.setItem("mycolor", scroll);//保存到本地
    })

    //左滑动
    /*mui('.y-xmzydiv').on('swipeleft','.y-xmzy-li',function(e){

       var h=$(this).index();
       $('.y-xmzy-nav').find('a').removeClass("active");
       $('.y-xmzy-nav').find('a').eq(h+1).addClass("active");
       $('.y-xmzydiv').find('.y-xmzy-li').hide();
       $('.y-xmzydiv').find('.y-xmzy-li').eq(h+1).show();
   });*/
    //右滑动
    /* mui('.y-xmzydiv').on('swiperight','.y-xmzy-li',function(){
         var h=$(this).index();
         $('.y-xmzy-nav').find('a').removeClass("active");
         $('.y-xmzy-nav').find('a').eq(h-1).addClass("active");
         $('.y-xmzydiv').find('.y-xmzy-li').hide();
         $('.y-xmzydiv').find('.y-xmzy-li').eq(h-1).show();
     });*/

</script>
<script>


    mui(".mui-bar-nav").on('doubletap', '.mui-title', function () {
        mui.scrollTo(0, 100);//回到屏幕顶部
    })
</script>
<script>
    //新增2018/7/5
    //活动完成通知滚动动画
    var mySwiper = new Swiper('.swiper-container', {
        autoplay: true,//可选选项，自动滑动
    })
</script>
</body>
</html>