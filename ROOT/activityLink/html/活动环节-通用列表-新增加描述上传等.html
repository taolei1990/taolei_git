<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <link href="../css/mui.min.css" rel="stylesheet" type="text/css">
    <link href="../css/w-custom.css" rel="stylesheet" type="text/css">
    <link href="../css/mui.picker.min.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="../js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../js/mui.min.js"></script>
    <script type="text/javascript" src="../js/mui.picker.min.js"></script>
</head>
<body class="mui-ios mui-ios-9 mui-ios-9-1">
<input type="hidden" id="pageIndex" value="1">
<script type="text/javascript">
    //顶部选择
    (function ($, doc) {
        $.init();
        $.ready(function () {
            /**
             * 获取对象属性的值
             * 主要用于过滤三级联动中，可能出现的最低级的数据不存在的情况，实际开发中需要注意这一点；
             * @param {Object} obj 对象
             * @param {String} param 属性名
             */
            var _getParam = function (obj, param) {
                return obj[param] || '';
            };
//一级选择
            var userPicker = new $.PopPicker();
            userPicker.setData([
                <!-- 活动环节 -->
                {
                        text: '情景导入'
                }
                , {
                        text: '主题研讨'
                }
                , {
                           text: '课程学习'
                }
                , {
                        text: '课程学习2'
                }
                , {
                       text: '作业'
                }
                , {
                         text: '活动成果'
                }
                , {
                        text: '互动答疑'
                }
                , {
                       text: '讨论区'
                }
                , {
                        text: '组长小结'
                }
                , {
                        text: '坊主小结'
                }
                , {
                        text: '课例观摩'
                }
                , {
                        text: '活动研讨室'
                }
                , {
                       text: '2+2互评'
                }
            ]);
            var showUserPickerButton = doc.getElementById('showUserPicker');
            var userResult = doc.getElementById('userResult');
            showUserPickerButton.addEventListener('tap', function (event) {
                userPicker.show(function (items) {
                    userResult.innerText = items[0].text;

//JSON.stringify(test);
//items[0].text
//返回 false 可以阻止选择框的关闭
//return false;
                });
            }, false);
//-----------------------------------------
        });
    })(mui, document);
</script>
<header class="mui-bar mui-bar-nav mui-bar-transparent w-subject-color" data-top="0" data-offset="150"
        data-duration="16" data-scrollby=".mui-scroll-wrapper">
    <a style="padding: 10px 0;" href="javascript:history.back();"><i class="iconfont w-back"></i></a>
    <h1 id="showUserPicker" class="mui-title"><span id="userResult" class="w-act-title">主题研讨</span><i class="iconfont "></i>
    </h1>
</header>
<div style="margin-top:45px;"></div>
<input type="hidden" id="sType" value="resource">
<input type="hidden" id="mType" value="other">
<!--新增描述-->
<div class="w-describe">
    <h5>主题研讨 <span>编辑描述</span></h5>
    <p class="w-description">描述描述描述描述</p>
</div>
<!--新增描述-->
<div class="w-ineedall mui-row">
    <div class="mui-col-sm-6 mui-col-xs-6">
        <div class="w-came">
            <select id="resourceType" name="cars">
                <option value="volvo">全部资源</option>
                <option value="saab">我的资源</option>
            </select>
            <select id="resourceType-1" style="display: none" name="cars">
                <option value="volvo">我点评的</option>
                <option value="saab">其他人点评</option>
            </select>
        </div>
    </div>

    <div class="mui-col-sm-6 mui-col-xs-6">
        <div class="mui-content-padded w-sort">
            <ul class="mui-pagination mui-pagination-sm">
                <li>
                    <a class="wm-sort wm-active" show="my">
                        上传类
                    </a>
                </li>
                <li>
                    <a class="wm-sort" show="other">
                        点评类
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>

<div class="w-performance" id="topic_content_list">
    <ul class="mui-table-view">
        <li class="mui-table-view-cell mui-media">
            <a  class="">
                <img class="mui-media-object mui-pull-left" src="http://upload2.yunjy.com.cn/avatar/8500/6724.jpg">
                <div class="mui-media-body">名称
                    <p class="mui-ellipsis">上传人</p>
                    <p>2018-03-22
                        <em><i class="iconfont">&#xe86f;</i>566</em>
                        <em><i class="iconfont">&#xe67d;</i>655</em>
                    </p>
                    <span class="confirmbtn"> <i class="iconfont ">&#xe656;</i></span>

                </div>
            </a>
        </li>
        <li class="mui-table-view-cell mui-media">
            <a  class="">
                <img class="mui-media-object mui-pull-left" src="http://upload2.yunjy.com.cn/avatar/8500/6724.jpg">
                <div class="mui-media-body">名称
                    <p class="mui-ellipsis">上传人</p>
                    <p>2018-03-22
                        <em><i class="iconfont">&#xe86f;</i>566</em>
                        <em><i class="iconfont">&#xe67d;</i>655</em>
                    </p>
                    <span class="confirmbtn"> <i class="iconfont ">&#xe656;</i></span>

                </div>
            </a>
        </li>
        <li class="mui-table-view-cell mui-media">
            <a  class="">
                <img class="mui-media-object mui-pull-left" src="http://upload2.yunjy.com.cn/avatar/8500/6724.jpg">
                <div class="mui-media-body">名称
                    <p class="mui-ellipsis">上传人</p>
                    <p>2018-03-22
                        <em><i class="iconfont">&#xe86f;</i>566</em>
                        <em><i class="iconfont">&#xe67d;</i>655</em>
                    </p>
                    <span class="confirmbtn"> <i class="iconfont ">&#xe656;</i></span>

                </div>
            </a>
        </li>
        <li class="mui-table-view-cell mui-media">
            <a  class="">
                <img class="mui-media-object mui-pull-left" src="http://upload2.yunjy.com.cn/avatar/8500/6724.jpg">
                <div class="mui-media-body">名称
                    <p class="mui-ellipsis">上传人</p>
                    <p>2018-03-22
                        <em><i class="iconfont">&#xe86f;</i>566</em>
                        <em><i class="iconfont">&#xe67d;</i>655</em>
                    </p>
                    <span class="confirmbtn"> <i class="iconfont ">&#xe656;</i></span>
                </div>
            </a>
        </li>
        <li class="mui-table-view-cell mui-media">
            <a  class="">
                <img class="mui-media-object mui-pull-left" src="http://upload2.yunjy.com.cn/avatar/8500/6724.jpg">
                <div class="mui-media-body">名称
                    <p class="mui-ellipsis">上传人</p>
                    <p>2018-03-22
                        <em><i class="iconfont">&#xe86f;</i>566</em>
                        <em><i class="iconfont">&#xe67d;</i>655</em>
                    </p>
                    <span class="confirmbtn"> <i class="iconfont ">&#xe656;</i></span>

                </div>
            </a>
        </li>
        <li class="mui-table-view-cell mui-media">
            <a class="">
                <img class="mui-media-object mui-pull-left" src="http://upload2.yunjy.com.cn/avatar/8500/6724.jpg">
                <div class="mui-media-body">名称
                    <p class="mui-ellipsis">上传人</p>
                    <p>2018-03-22
                        <em><i class="iconfont">&#xe86f;</i>566</em>
                        <em><i class="iconfont">&#xe67d;</i>655</em>
                    </p>
                    <span class="confirmbtn"> <i class="iconfont ">&#xe656;</i></span>

                </div>
            </a>
        </li>
        <li class="mui-table-view-cell mui-media">
            <a  class="">
                <img class="mui-media-object mui-pull-left" src="http://upload2.yunjy.com.cn/avatar/8500/6724.jpg">
                <div class="mui-media-body">名称
                    <p class="mui-ellipsis">上传人</p>
                    <p>2018-03-22
                        <em><i class="iconfont">&#xe86f;</i>566</em>
                        <em><i class="iconfont">&#xe67d;</i>655</em>
                    </p>
                    <span class="confirmbtn"> <i class="iconfont ">&#xe656;</i></span>

                </div>
            </a>
        </li>
        <li class="mui-table-view-cell mui-media">
            <a  class="">
                <img class="mui-media-object mui-pull-left" src="http://upload2.yunjy.com.cn/avatar/8500/6724.jpg">
                <div class="mui-media-body">名称
                    <p class="mui-ellipsis">上传人</p>
                    <p>2018-03-22
                        <em><i class="iconfont">&#xe86f;</i>566</em>
                        <em><i class="iconfont">&#xe67d;</i>655</em>
                    </p>
                    <span class="confirmbtn"> <i class="iconfont ">&#xe656;</i></span>
                </div>
            </a>
        </li>
    </ul>
</div>

<!--新增上传-->

<div class="w-upload">
    <a  class="w-btng w-sc">我要上传</a>
    <a href="#bottomPopover" class="w-btng w-dp">我要点评</a>
</div>
<!--新增上传结束-->

<!--新增编辑描述-->
<div class="w-desc-mask">
<div class="w-describe-text">
     <textarea maxlength="300" rows="5" placeholder="编辑描述" autofocus="autofocus"></textarea>
     <a>提交</a>
     <span>300</span>
</div>
</div>
<!--点评选项-->
<div id="bottomPopover" class="mui-popover mui-popover-bottom ys-popover">
    <div class="mui-popover-arrow"></div>
    <div class="mui-scroll-wrapper">
        <div class="mui-scroll">
            <ul class="mui-table-view">
                <li class="mui-table-view-cell"><a href="#"><i class="iconfont">&#xe940;</i>我要点评</a>
                </li>
                <li class="mui-table-view-cell"><a href="#"><i class="iconfont">&#xe69f;</i>选择资源给学员点评</a>
                </li>
            </ul>
        </div>
    </div>

</div>
<!--新增编辑描述结束-->
<script>
    //选项卡切换对应上传评论按钮
    $(".wm-sort").on("tap",function(){
        $(".wm-sort").removeClass("wm-active");
        $(this).addClass("wm-active");
        var inx = $(this).parent().index();

        $(".w-upload .w-btng").hide();
        $(".w-upload .w-btng").eq(inx).show();
        $("select[name=cars]").hide();
        $("select[name=cars]").eq(inx).show();
        if(inx==1){

            var x="";
            for (var i=0;i<10;i++)
            {
                x=x + "<li class='mui-table-view-cell mui-media'><a><img class='mui-media-object mui-pull-left' src='http://upload2.yunjy.com.cn/avatar/8500/6724.jpg'><div class='mui-media-body'>名称545645<p class='mui-ellipsis'>上传人<em class='w-dpe'>点评人:陶老师</em> </p><p>2018-03-22<em><i class='iconfont'>&#xe86f;</i>566</em><em><i class='iconfont'>&#xe67d;</i>655</em></p><span class='confirmbtn-1'> <i class='iconfont '>&#xe656;</i></span></div></a></li>";               // 通过 DOM 来测试
            }
            $("#topic_content_list .mui-table-view").html(x);

        }else {
            var x='';
            for (var i=0;i<14;i++){
                x=x + "<li class='mui-table-view-cell mui-media'><a><img class='mui-media-object mui-pull-left' src='http://upload2.yunjy.com.cn/avatar/8500/6724.jpg'><div class='mui-media-body'>名称545645<p class='mui-ellipsis'>上传人</p><p>2018-03-22<em><i class='iconfont'>&#xe86f;</i>566</em><em><i class='iconfont'>&#xe67d;</i>655</em></p><span class='confirmbtn'> <i class='iconfont '>&#xe656;</i></span></div></a></li>";               // 通过 DOM 来测试
            }
            $("#topic_content_list .mui-table-view").html(x);
        }
    });


</script>


<!--新增编辑描述结束-->
<script>
    $(function(){
        $(".w-describe span").click(function(event){
            var e=window.event || event;
            if(e.stopPropagation){
                e.stopPropagation();
            }else{
                e.cancelBubble = true;
            }
            $(".w-describe-text").show();
            $(".w-desc-mask").show();

        });
        $(".w-describe-text").click(function(event){
            var e=window.event || event;
            if(e.stopPropagation){
                e.stopPropagation();
            }else{
                e.cancelBubble = true;
            }
        });
        document.onclick = function(){
            $(".w-describe-text").hide();
            $(".w-desc-mask").hide();
        };
    })

</script>
<script>
    $(function(){
        //先选出 textarea 和 统计字数 dom 节点
        var wordCount = $(".w-describe-text"),
            textArea = wordCount.find("textarea"),
            word = wordCount.find("span"),
            supa = wordCount.find("a");

           textArea.val($(".w-description").text());
        var textval=textArea.val();
        if (textval.length>0){
            $('.w-describe-text a').addClass("active");
        }else{
            $('.w-describe-text a').removeClass("active");
        }
        //调用
        statInputNum(textArea,word);

        $(".w-describe-text a").click(function(){

            $(".w-description").text(textval);
            $(".w-desc-mask").hide();
            $(".w-describe-text").hide();
        });

    });
    /*
     * 剩余字数统计
     * 注意 最大字数只需要在放数字的节点哪里直接写好即可 如：<var class="word">200</var>
     */
    function statInputNum(textArea,numItem) {
        var max = numItem.text(),
            curLength;
        textArea[0].setAttribute("maxlength", max);
        curLength = textArea.val().length;
        numItem.text(max - curLength);
        textArea.on('input propertychange', function () {
            var _value = $(this).val().replace(/\n/gi,"");
            numItem.text(max - _value.length);
            var textval=textArea.val();
            if (textval.length>0){
                $('.w-describe-text a').addClass("active");
            }else{
                $('.w-describe-text a').removeClass("active");
            }
            $(".w-describe-text a").click(function(){

                $(".w-description").text(textval);
            });
        });
    }

</script>
<script>
    //资源修改-删除-取消操作
    $(".mui-table-view").on('tap','.confirmbtn', function() {
        $(this).addClass("remo");
        var btnArray = ['取消','修改', '删除'];
        mui.confirm('我精心为你提供以下服务哦', '亲！', btnArray, function(e) {
            if (e.index == 2) {
                $('.remo').parents('.mui-media').remove();
            }else if (e.index == 1) {
                //在这里进行修改作业操作
                mui.alert("你选择了修改操作")
            } else {
                //取消操作
            }

        })
    });
    //点评-取消 操作
    $(".mui-table-view").on('tap','.confirmbtn-1', function() {
        $(this).addClass("remo");
        var btnArray = ['取消','点评'];
        mui.confirm('你可以去点评', '亲！', btnArray, function(e) {
            if (e.index == 2) {
                $('.remo').parents('.mui-media').remove();
            }else if (e.index == 1) {
                //在这里进行修改作业操作
                mui.alert("点评操作")
            } else {
                //取消操作
            }

        })
    });

</script>
</body>
</html>