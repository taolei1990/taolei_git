<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
	<link href="../css/mui.min.css" rel="stylesheet" type="text/css">
	<link href="../css/w-custom.css" rel="stylesheet" type="text/css">
	<link href="../css/mui.picker.min.css" rel="stylesheet" type="text/css">
	<script src="../js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="../js/mui.min.js"></script>
	<script type="text/javascript" src="../js/mui.picker.min.js"></script>
</head>
<body class="mui-ios mui-ios-9 mui-ios-9-1">
<input type="hidden" id="pageIndex" value="1">
<script type="text/javascript">
    //顶部选择
    (function ($, doc) {
        $.init();
        $.ready(function () {
            /**
             * 获取对象属性的值
             * 主要用于过滤三级联动中，可能出现的最低级的数据不存在的情况，实际开发中需要注意这一点；
             * @param {Object} obj 对象
             * @param {String} param 属性名
             */
            var _getParam = function (obj, param) {
                return obj[param] || '';
            };
//一级选择
            var userPicker = new $.PopPicker();
            userPicker.setData([
                <!-- 活动环节 -->
                {
                     text: '情景导入'
                }
                , {
                    text: '主题研讨'
                }
                , {
                    text: '课程学习'
                }
                , {
                    text: '课程学习2'
                }
                , {
                       text: '作业'
                }
                , {
                       text: '活动成果'
                }
                , {
                       text: '互动答疑'
                }
                , {
                        text: '讨论区'
                }
                , {
                        text: '组长小结'
                }
                , {
                          text: '坊主小结'
                }
                , {
                            text: '课例观摩'
                }
                , {
                              text: '活动研讨室'
                }
                , {
                             text: '2+2互评'
                }
            ]);
            var showUserPickerButton = doc.getElementById('showUserPicker');
            var userResult = doc.getElementById('userResult');
            showUserPickerButton.addEventListener('tap', function (event) {
                userPicker.show(function (items) {
                    userResult.innerText = items[0].text;

//JSON.stringify(test);
//items[0].text
//返回 false 可以阻止选择框的关闭
//return false;
                });
            }, false);
//-----------------------------------------
        });
    })(mui, document);
</script>
<header class="mui-bar mui-bar-nav mui-bar-transparent w-subject-color" data-top="0" data-offset="150"
		data-duration="16" data-scrollby=".mui-scroll-wrapper">
	<a class=" mui-icon mui-icon-arrowleft mui-pull-left"></a>
	<h1 id="showUserPicker" class="mui-title"><span id="userResult" class="w-act-title">情景导入</span><i class="iconfont "></i>
	</h1>
</header>
<div style="margin-top:45px;"></div>
<input type="hidden" id="sType" value="resource">
<input type="hidden" id="mType" value="other">
<!--新增描述-->
<div class="w-describe">
	<h5>作业 <span>编辑描述</span></h5>
	<p class="w-description">录取他口头语音吗谢谢好的好的哟哟切克闹别跟我似的小时候只能吃到面和土豆，
		长大了别的也吧爱吃别跟我似的小时候只能吃到面和土豆，长大了别的也吧爱吃</p>
</div>

<div class="y-qjdrjl">
	<div class="y-wdjl">
		<h4>我的交流</h4>
		<ul>
			<li>
				<div class="w-touxe"><img src="../img/qd-yqd.png"></div>
				<div class="w-pjnr">
					<h5>陶老师</h5>
					<p class="pnxq">小时候只能吃到面和土豆长大了别的也吧爱吃</p>
					<p class="pnsjhf"><span>2018/7/9 15:31</span><span>删除</span></p></div>
			</li>
		</ul>
	</div>
	<div class="y-wdjl">
		<h4>全部交流 <span>（5）</span></h4>
		<ul>
			<li>
				<div class="w-touxe"><img src="../img/3c28af542f2d49f.jpg"></div>
				<div class="w-pjnr">
					<h5>陶老师</h5>
					<p class="pnxq">小时候只能吃到面和土豆长大了别的也吧爱吃</p>
					<p class="pnsjhf"><span>2018/7/9 15:31</span><span><i class="iconfont">&#xe679;</i> 6</span></p>
				</div>
			</li>
			<li>
				<div class="w-touxe">
					<img src="../img/3c28af542f2d49f.jpg">
				    <div class="y-zjtx">专家</div>
				</div>
				<div class="w-pjnr">
					<h5>陶老师 <span>发起人</span></h5>
					<p class="pnxq">小时候只能吃到面和土豆长大了别的也吧爱吃</p>
					<p class="pnsjhf"><span>2018/7/9 15:31</span><span><i class="iconfont">&#xe679;</i> 6</span></p>
				</div>
			</li>
			<li>
				<div class="w-touxe">
					<img src="../img/3c28af542f2d49f.jpg">
					<div class="y-zjtx">专家</div>
				</div>
				<div class="w-pjnr">
					<h5>陶老师</h5>
					<p class="pnxq">小时候只能吃到面和土豆长大了别的也吧爱吃</p>
					<p class="pnsjhf"><span>2018/7/9 15:31</span><span><i class="iconfont">&#xe679;</i> 6</span></p>
				</div>
			</li>
			<li>
				<div class="w-touxe"><img src="../img/3c28af542f2d49f.jpg"></div>
				<div class="w-pjnr">
					<h5>陶老师</h5>
					<p class="pnxq">小时候只能吃到面和土豆长大了别的也吧爱吃</p>
					<p class="pnsjhf"><span>2018/7/9 15:31</span><span><i class="iconfont">&#xe679;</i> 6</span></p>
				</div>
			</li>
			<li>
				<div class="w-touxe"><img src="../img/qd-yqd.png"></div>
				<div class="w-pjnr">
					<h5>陶老师</h5>
					<p class="pnxq">小时候只能吃到面和土豆长大了别的也吧爱吃</p>
					<p class="pnsjhf"><span>2018/7/9 15:31</span><span><i class="iconfont">&#xe679;</i> 6</span></p>
				</div>
			</li>
		</ul>
	</div>
</div>
<!--评论-->
<div class="y-srpl">
    <p>发表评论...</p>
</div>
<!--评论弹窗-->
<div class="y-plunsck">
	<div class="y-textdiv">
		<div class="y-textdivspan">
			<span class="y-quexiao">取消</span>

			<span class="y-fabiao">发表</span>
		</div>
		<div class="y-inputframe">
			<div class="cgzs-tjfj"></div>
			<textarea rows="5" id="username" class="inputframe" autofocus onKeyUp='keypress()' onblur='keypress()' placeholder="我来说两句"></textarea></div>
	</div>
</div>

<!--新增编辑描述-->
<div class="w-desc-mask">

	<div class="w-describe-text">

		<textarea maxlength="300" placeholder="编辑描述" autofocus="autofocus"></textarea>
		<a>提交</a>
		<span>300</span>

	</div>
</div>
<!--新增编辑描述结束-->

<script>
    //删除作业
    mui(".w-zybz").on('tap','.confirmbtn', function() {
        $(this).addClass("remo");
        var btnArray = ['取消', '删除'];
        mui.confirm('你将要删除作业？', '提示', btnArray, function(e) {
            if (e.index == 1) {
                $('.remo').parents('.w-zybz').remove();

            } else {
                //选择了取消
            }
        })
    });
</script>
<script>
	//编辑描述
    $(function(){
        $(".w-describe span").click(function(event){
            var e=window.event || event;
            if(e.stopPropagation){
                e.stopPropagation();
            }else{
                e.cancelBubble = true;
            }
            $(".w-describe-text").show();
            $(".w-desc-mask").show();

        });
        $(".w-describe-text").click(function(event){
            var e=window.event || event;
            if(e.stopPropagation){
                e.stopPropagation();
            }else{
                e.cancelBubble = true;
            }
        });
        document.onclick = function(){
            $(".w-describe-text").hide();
            $(".w-desc-mask").hide();
        };
    })

</script>
<script>
    $(function(){
        //先选出 textarea 和 统计字数 dom 节点
        var wordCount = $(".w-describe-text"),
            textArea = wordCount.find("textarea"),
            word = wordCount.find("span"),
            supa = wordCount.find("a");

        textArea.val($(".w-description").text());
        var textval=textArea.val();
        if (textval.length>0){
            $('.w-describe-text a').addClass("active");
        }else{
            $('.w-describe-text a').removeClass("active");
        }
        //调用
        statInputNum(textArea,word);

        $(".w-describe-text a").click(function(){

            $(".w-description").text(textval);
            $(".w-desc-mask").hide();
            $(".w-describe-text").hide();
        });

    });
	/*
	 * 剩余字数统计
	 * 注意 最大字数只需要在放数字的节点哪里直接写好即可 如：<var class="word">200</var>
	 */
    function statInputNum(textArea,numItem) {
        var max = numItem.text(),
            curLength;
        textArea[0].setAttribute("maxlength", max);
        curLength = textArea.val().length;
        numItem.text(max - curLength);
        textArea.on('input propertychange', function () {
            var _value = $(this).val().replace(/\n/gi,"");
            numItem.text(max - _value.length);
            var textval=textArea.val();
            if (textval.length>0){
                $('.w-describe-text a').addClass("active");
            }else{
                $('.w-describe-text a').removeClass("active");
            }
            $(".w-describe-text a").click(function(){

                $(".w-description").text(textval);
            });
        });
    }

</script>
<script>

    //打开回复框
    mui(".y-srpl").on('tap', 'p', function () {
        $('.y-plunsck').show();
        $('.y-ktyjcz').hide();
        $('.inputframe').trigger("click").focus().attr('placeholder',"发表评论...");

    });

    //取消
    mui(".y-textdivspan").on('tap', '.y-quexiao', function () {
        $('.y-plunsck').hide();
        $('.y-ktyjcz').show();
    });
    //打开软键盘
    var nativeWebview, imm, InputMethodManager;
    var initNativeObjects = function() {
        if (mui.os.android) {
            var main = plus.android.runtimeMainActivity();
            var Context = plus.android.importClass("android.content.Context");
            InputMethodManager = plus.android.importClass("android.view.inputmethod.InputMethodManager");
            imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);
        } else {
            nativeWebview = plus.webview.currentWebview().nativeInstanceObject();
        }
    };
    var showSoftInput = function() {
        var nativeWebview = plus.webview.currentWebview().nativeInstanceObject();
        if (mui.os.android) {
            //强制当前webview获得焦点
            plus.android.importClass(nativeWebview);
            nativeWebview.requestFocus();
            imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);
        } else {
            nativeWebview.plusCallMethod({
                "setKeyboardDisplayRequiresUserAction": false
            });
        }
        setTimeout(function() {
            //此处可写具体逻辑设置获取焦点的input
            var inputElem = document.querySelector('input.inputframe');
            inputElem.focus();
        }, 200);
    };
    mui.plusReady(function() {
        initNativeObjects();
        showSoftInput();
    });

    function keypress() //textarea输入长度处理
    {
        var text1=document.getElementById("username").value;

        if(text1.length>0)//textarea控件不能用maxlength属性，就通过这样显示输入字符数了
        {
            $('.y-fabiao').addClass('active');
        }
        else
        {
            $('.y-fabiao').removeClass('active');
        }
    }
</script>

<script>
    mui('.mui-bar-nav').on('tap', '.mui-icon-arrowleft', function () {
        mui.openWindow({
            url:'../../activity_home.html?myxz=1',//链接带参数2018/7/6
            id:''
        });
    });
</script>
</body>
</html>